---
import "../styles/global.css";

interface Props {
  title?: string;
}

const { title = "10x Astro Starter" } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" href="/favicon.svg">
    <meta name="generator" content={Astro.generator} />
    <script is:inline>
      (function () {
        const storageKey = "fap-log-viewer-theme";
        const mediaQuery = "(prefers-color-scheme: dark)";
        const root = document.documentElement;

        const applyTheme = (theme) => {
          root.classList.toggle("dark", theme === "dark");
          root.dataset.theme = theme;
          root.style.colorScheme = theme === "dark" ? "dark light" : "light dark";
        };

        const setPreferenceDataset = (preference) => {
          root.dataset.themePreference = preference;
        };

        const safelyReadStorage = () => {
          try {
            const stored = window.localStorage.getItem(storageKey);
            return stored === "light" || stored === "dark" ? stored : null;
          } catch (error) {
            return null;
          }
        };

        const storedPreference = safelyReadStorage();
        const media = window.matchMedia ? window.matchMedia(mediaQuery) : null;
        const systemPrefersDark = media ? media.matches : false;

        const preference = storedPreference ?? "system";
        const resolvedTheme = preference === "system" ? (systemPrefersDark ? "dark" : "light") : preference;

        applyTheme(resolvedTheme);
        setPreferenceDataset(preference);
      })();
    </script>
    <title>{title}</title>
  </head>
  <body>
    <slot />
  </body>
</html>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }
</style>
